humhub.module("mail.notification",function(n,e,o){var t,i=e("client"),a=e("ui.loader"),s=e("event"),l=e("ui.widget").Widget;n.initOnPjaxLoad=!0;var u=function(){},r=function(e){};n.export({init:function(e){e||(s.on("humhub:modules:mail:live:NewUserMessage",function(e,n){s=n[n.length-1],r(s.data.count)}).on("humhub:modules:mail:live:UserMessageDeleted",function(e,n){s=n[n.length-1],r(s.data.count)}),o("#icon-messages").click(function(){t&&t.abort(),o("#loader_messages").parent().find(":not(#loader_messages)").remove(),a.set(o("#loader_messages").show()),i.get(n.config.url.list,{beforeSend:function(e){t=e}}).then(function(e){t=void 0,o("#loader_messages").parent().prepend(o(e.html)),o("#loader_messages").hide()})})),u()},loadMessage:function(e){o("#mail-conversation-root").length?l.instance("#mail-conversation-root").loadMessage(e):i.redirect(e.url),e.finish()},setMailMessageCount:r,updateCount:u})});